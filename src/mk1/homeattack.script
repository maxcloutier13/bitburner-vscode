var directory = "/mk1/scan/";
var target = read(directory + "target.txt");
var cost = 0;
var threads = 0;
var currentScript = [];
disableLog("ALL");
//tail();

//Check if target is vulnerable
print("--- Checking " + target + " for weakness ---");
while (hasRootAccess(target) === false) {
	print("Server locked... waiting... ")
	sleep(10000);
}
//Kill old scripts
print("-- Killing old scripts --")
var scripts = ps("home");
for (i = 0; i < scripts.length; ++i) {
	//print("Script running " + scripts[i].filename);
	//print("Arguments: " + scripts[i].args);
	currentScript = scripts[i];
	print("-- CurrentScript: " + currentScript.filename);
	if (currentScript.filename === "/mk1/weaken.script") {
		print("-- Kill Weaken --");
		kill(currentScript.filename, "home", currentScript.args[0]);
	}

	if (currentScript.filename === "/mk1/grow.script") {
		print("-- Kill Grow --");
		kill(currentScript.filename, "home", currentScript.args[0]);
	}

	if (currentScript.filename === "/mk1/steal.script") {
		print("-- Kill Steal --");
		kill(currentScript.filename, "home", currentScript.args[0]);
	}
}
kill("/mk1/weaken.script", "home", "");
kill("/mk1/grow.script", "home");
kill("/mk1/steal.script", "home");
print("--- Server weak ---");
//Calculate ram and use 1/4th for each script
var currentRam = getServerMaxRam("home");
var dedicatedRam = currentRam / 4;
//Weaken
cost = getScriptRam("/mk1/weaken.script", "home");
threads = Math.floor(dedicatedRam / cost);
print("--- Running weaken on " + threads + " threads ---");
run("/mk1/weaken.script", threads, target);
//Grow
cost = getScriptRam("/mk1/grow.script", "home");
threads = Math.floor(dedicatedRam / cost);
print("--- Running grow on " + threads + " threads ---");
run("/mk1/grow.script", threads, target);
//Hack
cost = getScriptRam("/mk1/steal.script", "home");
threads = Math.floor(dedicatedRam / cost);
print("--- Running hack on " + threads + " threads ---");
run("/mk1/steal.script", threads, target);
//All done!
alert("Home is attacking: " + target);